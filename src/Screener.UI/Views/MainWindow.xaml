<Window x:Class="Screener.UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Screener.UI.ViewModels"
        xmlns:controls="clr-namespace:Screener.UI.Views.Controls"
        mc:Ignorable="d"
        Title="Shot Clipper - Video Capture"
        Icon="/screener.ico"
        Height="800" Width="1400"
        MinHeight="720" MinWidth="1280"
        Background="{DynamicResource BackgroundLevel0Brush}"
        WindowStartupLocation="CenterScreen">

    <Window.InputBindings>
        <KeyBinding Key="F9" Command="{Binding ToggleRecordingCommand}"/>
        <KeyBinding Key="F9" Modifiers="Shift" Command="{Binding TogglePauseCommand}"/>
        <KeyBinding Key="M" Command="{Binding AddMarkerCommand}"/>
        <KeyBinding Key="I" Command="{Binding SetInPointCommand}"/>
        <KeyBinding Key="O" Command="{Binding SetOutPointCommand}"/>
        <KeyBinding Key="F11" Command="{Binding ToggleFullscreenCommand}"/>
        <KeyBinding Key="Esc" Command="{Binding ExitFullscreenCommand}"/>
        <KeyBinding Key="OemComma" Modifiers="Ctrl" Command="{Binding OpenSettingsCommand}"/>
        <KeyBinding Key="D1" Command="{Binding CutToSource1Command}"/>
        <KeyBinding Key="D2" Command="{Binding CutToSource2Command}"/>
    </Window.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <!-- Menu Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Toolbar -->
            <RowDefinition Height="Auto"/>
            <!-- Main Content -->
            <RowDefinition Height="*"/>
            <!-- Status Bar -->
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="{DynamicResource BackgroundLevel1Brush}">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" InputGestureText="Ctrl+N"/>
                <MenuItem Header="_Open Project" InputGestureText="Ctrl+O"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}" InputGestureText="Alt+F4"/>
            </MenuItem>
            <MenuItem Header="_Recording">
                <MenuItem Header="_Start Recording" Command="{Binding ToggleRecordingCommand}" InputGestureText="F9"/>
                <MenuItem Header="_Pause Recording" Command="{Binding TogglePauseCommand}" InputGestureText="Shift+F9"/>
                <Separator/>
                <MenuItem Header="Add _Marker" Command="{Binding AddMarkerCommand}" InputGestureText="M"/>
                <MenuItem Header="Set _In Point" Command="{Binding SetInPointCommand}" InputGestureText="I"/>
                <MenuItem Header="Set _Out Point" Command="{Binding SetOutPointCommand}" InputGestureText="O"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Fullscreen Preview" Command="{Binding ToggleFullscreenCommand}" InputGestureText="F11"/>
                <Separator/>
                <MenuItem Header="Show _Left Panel" IsCheckable="True" IsChecked="{Binding IsLeftPanelVisible}"/>
                <MenuItem Header="Show _Right Panel" IsCheckable="True" IsChecked="{Binding IsRightPanelVisible}"/>
            </MenuItem>
            <MenuItem Header="_Stream">
                <MenuItem Command="{Binding ToggleStreamCommand}">
                    <MenuItem.Style>
                        <Style TargetType="MenuItem">
                            <Setter Property="Header" Value="_Start Stream"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                    <Setter Property="Header" Value="_Stop Stream"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </MenuItem.Style>
                </MenuItem>
                <MenuItem Header="_Copy Stream URL" Command="{Binding CopyStreamUrlCommand}"/>
                <Separator/>
                <MenuItem Header="_NDI Output" IsCheckable="True" IsChecked="{Binding IsNdiOutputActive}"
                          Visibility="{Binding IsNdiAvailable, Converter={StaticResource BoolToVisibilityConverter}}"/>
                <MenuItem Header="S_RT Output" IsCheckable="True" IsChecked="{Binding IsSrtOutputActive}"/>
                <Separator/>
                <MenuItem Header="Stream _Settings..." Command="{Binding OpenStreamSettingsCommand}"/>
            </MenuItem>
            <MenuItem Header="_Golf">
                <MenuItem Header="Toggle _Golf Mode" IsCheckable="True" IsChecked="{Binding IsGolfModeEnabled}"/>
                <Separator/>
                <MenuItem Header="Cut to _Golfer (1)" Command="{Binding CutToSource1Command}" InputGestureText="1"/>
                <MenuItem Header="Cut to _Simulator (2)" Command="{Binding CutToSource2Command}" InputGestureText="2"/>
                <Separator/>
                <MenuItem Header="_Auto-Cut" IsCheckable="True" IsChecked="{Binding IsAutoCutEnabled}"/>
                <MenuItem Header="C_alibrate Idle" Command="{Binding CalibrateIdleCommand}"/>
                <Separator/>
                <MenuItem Header="_Start Session" Command="{Binding StartGolfSessionCommand}"/>
                <MenuItem Header="_End Session" Command="{Binding StopGolfSessionCommand}"/>
                <Separator/>
                <MenuItem Header="_Manage Golfers..." Command="{Binding OpenGolferManagementCommand}"/>
                <MenuItem Header="_Overlay Settings..." Command="{Binding OpenOverlaySettingsCommand}"/>
            </MenuItem>
            <MenuItem Header="_Tools">
                <MenuItem Header="_Settings..." Command="{Binding OpenSettingsCommand}" InputGestureText="Ctrl+,"/>
                <MenuItem Header="_Scheduler..." Command="{Binding OpenSchedulerCommand}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_About Shot Clipper"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <Border Grid.Row="1" Background="{DynamicResource ToolbarGradient}"
                BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="0,0,0,1"
                Padding="8,6">
            <StackPanel Orientation="Horizontal">
                <!-- Quality Preset -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                    <TextBlock Text="Preset:" Foreground="{DynamicResource TextSecondaryBrush}"
                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="120"
                              ItemsSource="{Binding AvailablePresets}"
                              SelectedItem="{Binding SelectedPreset}"
                              DisplayMemberPath="Name"/>
                </StackPanel>

                <!-- Separator -->
                <Border Width="1" Height="32" Margin="8,0" Opacity="0.4">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="Transparent" Offset="0"/>
                            <GradientStop Color="{StaticResource BorderMedium}" Offset="0.5"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <!-- Drive Selector -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0">
                    <TextBlock Text="Drive:" Foreground="{DynamicResource TextSecondaryBrush}"
                               VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <ComboBox Width="200"
                              ItemsSource="{Binding AvailableDrives}"
                              SelectedItem="{Binding SelectedDrive}">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{Binding Name}" Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding FreeSpaceDisplay}"
                                               Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <!-- Separator -->
                <Border Width="1" Height="32" Margin="8,0" Opacity="0.4">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="Transparent" Offset="0"/>
                            <GradientStop Color="{StaticResource BorderMedium}" Offset="0.5"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <!-- Stream Toggle -->
                <ToggleButton Style="{DynamicResource StreamToggleButtonStyle}"
                              IsChecked="{Binding IsStreaming}"
                              ToolTip="Toggle Stream"
                              Height="32" Margin="8,0"/>

                <!-- NDI Output Toggle (visible only when NDI runtime installed) -->
                <ToggleButton IsChecked="{Binding IsNdiOutputActive}"
                              ToolTip="Toggle NDI Output"
                              Height="32" Margin="4,0"
                              Padding="8,4"
                              Visibility="{Binding IsNdiAvailable, Converter={StaticResource BoolToVisibilityConverter}}">
                    <TextBlock Text="NDI" FontSize="11" FontWeight="SemiBold"/>
                </ToggleButton>

                <!-- SRT Output Toggle -->
                <ToggleButton IsChecked="{Binding IsSrtOutputActive}"
                              ToolTip="Toggle SRT Output"
                              Height="32" Margin="4,0"
                              Padding="8,4">
                    <TextBlock Text="SRT" FontSize="11" FontWeight="SemiBold"/>
                </ToggleButton>

                <!-- Golf Mode Toggle -->
                <Border Width="1" Height="32" Margin="8,0" Opacity="0.4">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="Transparent" Offset="0"/>
                            <GradientStop Color="{StaticResource BorderMedium}" Offset="0.5"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>
                <ToggleButton IsChecked="{Binding IsGolfModeEnabled}"
                              ToolTip="Toggle Golf Mode"
                              Height="32" Margin="4,0"
                              Padding="10,4">
                    <ToggleButton.Style>
                        <Style TargetType="ToggleButton">
                            <Setter Property="Background" Value="Transparent"/>
                            <Style.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter Property="Background" Value="#4044BB44"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ToggleButton.Style>
                    <TextBlock Text="GOLF" FontSize="11" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}"/>
                </ToggleButton>

                <!-- SRT Output Status -->
                <TextBlock Text="{Binding SrtOutputStatus}"
                           Foreground="{DynamicResource AccentBlueBrush}"
                           VerticalAlignment="Center" Margin="4,0,0,0"
                           FontSize="11"
                           Visibility="{Binding IsSrtOutputActive, Converter={StaticResource BoolToVisibilityConverter}}"/>

                <!-- Stream URL with fade-in (visible when streaming) -->
                <StackPanel x:Name="StreamUrlPanel" Orientation="Horizontal" VerticalAlignment="Center"
                            Visibility="{Binding IsStreaming, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsStreaming}" Value="True">
                                    <DataTrigger.EnterActions>
                                        <BeginStoryboard>
                                            <Storyboard>
                                                <DoubleAnimation Storyboard.TargetProperty="Opacity"
                                                                 From="0" To="1" Duration="0:0:0.3"/>
                                            </Storyboard>
                                        </BeginStoryboard>
                                    </DataTrigger.EnterActions>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock Text="{Binding StreamUrl, TargetNullValue='Starting...'}"
                               Foreground="{DynamicResource AccentBlueBrush}"
                               VerticalAlignment="Center" Margin="8,0,0,0"
                               FontSize="11"/>
                    <Button Content="Copy" Command="{Binding CopyStreamUrlCommand}"
                            Margin="4,0,0,0" Padding="8,2"
                            FontSize="11" VerticalAlignment="Center"
                            Style="{DynamicResource SecondaryButtonStyle}"/>
                    <Button x:Name="QrButton" Content="QR" Command="{Binding ShowQrCodeCommand}"
                            Margin="4,0,0,0" Padding="8,2"
                            FontSize="11" VerticalAlignment="Center"
                            Style="{DynamicResource SecondaryButtonStyle}"/>
                </StackPanel>

                <!-- Separator -->
                <Border Width="1" Height="32" Margin="8,0" Opacity="0.4">
                    <Border.Background>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                            <GradientStop Color="Transparent" Offset="0"/>
                            <GradientStop Color="{StaticResource BorderMedium}" Offset="0.5"/>
                            <GradientStop Color="Transparent" Offset="1"/>
                        </LinearGradientBrush>
                    </Border.Background>
                </Border>

                <!-- Recording Controls (compact toolbar version) -->
                <Button Style="{DynamicResource RecordButtonStyle}"
                        Command="{Binding ToggleRecordingCommand}"
                        Width="36" Height="36" Margin="4,0"
                        ToolTip="Toggle Recording (F9)"/>

                <TextBox Text="{Binding RecordingName, UpdateSourceTrigger=PropertyChanged}"
                         Width="140" Height="28" Margin="4,0"
                         Background="{DynamicResource BackgroundLevel0Brush}"
                         Foreground="{DynamicResource TextPrimaryBrush}"
                         BorderBrush="{DynamicResource BorderSubtleBrush}"
                         Padding="6,4" FontSize="11" VerticalContentAlignment="Center"
                         ToolTip="Recording Name"/>

                <TextBlock Text="{Binding RecordingStatusText}"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           VerticalAlignment="Center" FontSize="12" Margin="4,0"
                           MinWidth="60"/>
            </StackPanel>
        </Border>

        <!-- QR Code Popup -->
        <Popup IsOpen="{Binding IsQrCodeVisible}" StaysOpen="False"
               PlacementTarget="{Binding ElementName=QrButton}" Placement="Bottom"
               PopupAnimation="Fade" AllowsTransparency="True">
            <Border Background="{DynamicResource BackgroundLevel2Brush}"
                    BorderBrush="{DynamicResource BorderMediumBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="16"
                    Effect="{DynamicResource FloatingShadow}">
                <StackPanel>
                    <TextBlock Text="Scan to connect" Foreground="{DynamicResource TextSecondaryBrush}"
                               FontSize="12" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                    <Image Source="{Binding QrCodeImage, Converter={StaticResource ByteArrayToImageConverter}}"
                           Width="200" Height="200"
                           RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                    <TextBlock Text="{Binding StreamUrl}" Foreground="{DynamicResource AccentBlueBrush}"
                               FontSize="11" HorizontalAlignment="Center" Margin="0,8,0,0"
                               TextWrapping="Wrap" MaxWidth="200"/>
                </StackPanel>
            </Border>
        </Popup>

        <!-- Viewers Popup -->
        <Popup IsOpen="{Binding IsViewersPopupVisible}" StaysOpen="False"
               PlacementTarget="{Binding ElementName=ViewersButton}" Placement="Top"
               PopupAnimation="Fade" AllowsTransparency="True">
            <Border Background="{DynamicResource BackgroundLevel2Brush}"
                    BorderBrush="{DynamicResource BorderMediumBrush}"
                    BorderThickness="1" CornerRadius="8" Padding="12"
                    Effect="{DynamicResource FloatingShadow}"
                    MinWidth="280">
                <StackPanel>
                    <TextBlock Text="Connected Viewers" Foreground="{DynamicResource TextPrimaryBrush}"
                               FontSize="13" FontWeight="SemiBold" Margin="0,0,0,8"/>

                    <!-- Viewer list -->
                    <ItemsControl ItemsSource="{Binding ConnectedViewersList}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="{DynamicResource BackgroundLevel1Brush}"
                                        CornerRadius="4" Padding="8,6" Margin="0,0,0,4">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0">
                                            <TextBlock Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12">
                                                <Run Text="{Binding RemoteAddress, Mode=OneWay}"/>
                                            </TextBlock>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding Id, StringFormat='ID: {0}'}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="10"/>
                                                <TextBlock Text=" | " Foreground="{DynamicResource TextSecondaryBrush}" FontSize="10"/>
                                                <TextBlock Text="{Binding ConnectionDuration}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="10"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <Button Grid.Column="1" Content="&#xE711;" FontFamily="Segoe MDL2 Assets"
                                                FontSize="12" Foreground="{DynamicResource AccentRedBrush}"
                                                Background="Transparent" BorderThickness="0" Cursor="Hand"
                                                Padding="4,2" VerticalAlignment="Center"
                                                Command="{Binding DataContext.DisconnectViewerCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                                CommandParameter="{Binding Id}"
                                                ToolTip="Disconnect viewer"/>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <!-- No viewers fallback -->
                    <TextBlock Text="No viewers connected" FontSize="12"
                               Foreground="{DynamicResource TextSecondaryBrush}"
                               HorizontalAlignment="Center" Margin="0,4,0,4">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ConnectedViewersList.Count}" Value="0">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Border>
        </Popup>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <!-- Left Panel -->
                <ColumnDefinition Width="280" MinWidth="200" MaxWidth="450"/>
                <ColumnDefinition Width="Auto"/>
                <!-- Center (Preview) -->
                <ColumnDefinition Width="*" MinWidth="640"/>
                <ColumnDefinition Width="Auto"/>
                <!-- Right Panel -->
                <ColumnDefinition Width="300" MinWidth="240" MaxWidth="400"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Clip Bin & Upload Queue -->
            <Grid Grid.Column="0" Background="{DynamicResource BackgroundLevel1Brush}"
                  Visibility="{Binding IsLeftPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="200"/>
                </Grid.RowDefinitions>

                <!-- Clip Bin -->
                <Border Grid.Row="0" Margin="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="CLIP BIN" Style="{DynamicResource PanelHeaderStyle}" Grid.Row="0"/>
                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding ClipBin.Clips}"
                                 SelectedItem="{Binding ClipBin.SelectedClip}"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 HorizontalContentAlignment="Stretch"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Padding" Value="6"/>
                                    <Setter Property="Margin" Value="0,2"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border x:Name="Border"
                                                        Background="{DynamicResource BackgroundLevel2Brush}"
                                                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                                                        BorderThickness="1"
                                                        CornerRadius="4"
                                                        Padding="{TemplateBinding Padding}">
                                                    <ContentPresenter/>
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsSelected" Value="True">
                                                        <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource AccentBlueBrush}"/>
                                                    </Trigger>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter TargetName="Border" Property="Background" Value="{DynamicResource BackgroundLevel3Brush}"/>
                                                    </Trigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Clip name and info -->
                                        <TextBlock Grid.Row="0" Grid.Column="0"
                                                   Text="{Binding FileName}"
                                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                                   FontSize="12" TextTrimming="CharacterEllipsis"
                                                   ToolTip="{Binding FilePath}"/>

                                        <!-- Action buttons -->
                                        <StackPanel Grid.Row="0" Grid.Column="1" Orientation="Horizontal">
                                            <Button Content="&#xE8A7;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                                    Command="{Binding PlayFileCommand}"
                                                    ToolTip="Play"
                                                    Background="Transparent" BorderThickness="0"
                                                    Foreground="{DynamicResource TextSecondaryBrush}"
                                                    Cursor="Hand" Padding="4,2" Margin="2,0"/>
                                            <Button Content="&#xED25;" FontFamily="Segoe MDL2 Assets" FontSize="12"
                                                    Command="{Binding RevealInExplorerCommand}"
                                                    ToolTip="Show in Explorer"
                                                    Background="Transparent" BorderThickness="0"
                                                    Foreground="{DynamicResource TextSecondaryBrush}"
                                                    Cursor="Hand" Padding="4,2" Margin="2,0"/>
                                        </StackPanel>

                                        <!-- Duration and file size -->
                                        <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                                                    Orientation="Horizontal" Margin="0,2,0,0">
                                            <TextBlock Text="{Binding Duration, StringFormat='{}{0:hh\\:mm\\:ss}'}"
                                                       Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                            <TextBlock Text=" - " Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                            <TextBlock Text="{Binding FileSizeDisplay}"
                                                       Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                                        </StackPanel>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch"
                              Background="{DynamicResource BorderSubtleBrush}"/>

                <!-- Upload Queue -->
                <Border Grid.Row="2" Margin="4">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="UPLOAD QUEUE" Style="{DynamicResource PanelHeaderStyle}" Grid.Row="0"/>
                        <ListBox Grid.Row="1"
                                 ItemsSource="{Binding UploadQueue.Jobs}"
                                 Background="Transparent"
                                 BorderThickness="0">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid Margin="4">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <TextBlock Text="{Binding FileName}" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                        <ProgressBar Grid.Row="1" Height="4" Margin="0,4,0,0"
                                                     Value="{Binding ProgressPercent}"
                                                     Background="{DynamicResource BackgroundLevel2Brush}"
                                                     Foreground="{DynamicResource AccentBlueBrush}"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center"
                          Background="{DynamicResource BorderSubtleBrush}"
                          Visibility="{Binding IsLeftPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <!-- Center: vMix-Style Switcher Layout -->
            <Grid Grid.Column="2" Background="{DynamicResource BackgroundLevel0Brush}">
                <Grid.RowDefinitions>
                    <!-- Row 0: Preview | Transitions | Program (constrained) -->
                    <RowDefinition Height="Auto"/>
                    <!-- Row 1: Input Source Strip (takes remaining space) -->
                    <RowDefinition Height="*"/>
                    <!-- Row 2: Status Bar -->
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Row 0: Preview (left) | Transition Controls (center) | Program (right) -->
                <Grid Grid.Row="0" Margin="8,8,8,4" MaxHeight="480">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- PREVIEW Monitor (left) — shows the non-program source -->
                    <Border Grid.Column="0" CornerRadius="4"
                            Effect="{DynamicResource MonitorShadow}">
                        <Border CornerRadius="4" ClipToBounds="True">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="BorderThickness" Value="3"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource TallyDefaultBrush}"/>
                                    <Style.Triggers>
                                        <!-- Green tally border when preview has signal -->
                                        <DataTrigger Binding="{Binding PreviewSourceHasSignal}" Value="True">
                                            <Setter Property="BorderBrush" Value="{DynamicResource TallyGreenBrush}"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid Background="#111">
                                <Viewbox Stretch="Uniform">
                                    <Canvas Width="1920" Height="1080" Background="{DynamicResource BackgroundLevel0Brush}">
                                        <Image Source="{Binding PreviewSourceImage}" Stretch="Fill"
                                               Width="1920" Height="1080"
                                               RenderOptions.BitmapScalingMode="LowQuality"/>
                                        <!-- Preview lower third overlay (semi-transparent, always visible when text is set) -->
                                        <Border Canvas.Left="{Binding Switcher.LowerThirdX}"
                                                Canvas.Top="{Binding Switcher.LowerThirdY}"
                                                Background="#CC000000" CornerRadius="4" Padding="24,10"
                                                Opacity="0.7" IsHitTestVisible="False"
                                                Visibility="{Binding Switcher.IsPreviewLowerThirdVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <TextBlock Text="{Binding Switcher.LowerThirdText}"
                                                       Foreground="White" FontSize="42" FontWeight="SemiBold"/>
                                        </Border>
                                    </Canvas>
                                </Viewbox>
                                <!-- PREVIEW label badge (green) -->
                                <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                                        Background="{DynamicResource PreviewBadgeBrush}" Padding="10,4" Margin="8,6"
                                        CornerRadius="3">
                                    <TextBlock Text="PREVIEW" Foreground="White" FontSize="11"
                                               FontWeight="Bold"/>
                                </Border>
                                <!-- Source name overlay (bottom-left) -->
                                <Border HorizontalAlignment="Left" VerticalAlignment="Bottom"
                                        Background="#80000000" Padding="8,3" Margin="8,0,0,8"
                                        CornerRadius="3" IsHitTestVisible="False">
                                    <TextBlock Text="{Binding PreviewSourceName}" Foreground="White"
                                               FontSize="10" FontWeight="SemiBold"/>
                                </Border>
                                <!-- No signal overlay -->
                                <Grid IsHitTestVisible="False"
                                      Visibility="{Binding PreviewSourceHasSignal, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                                    <Rectangle Fill="{DynamicResource NoSignalCrosshatchBrush}"/>
                                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                        <TextBlock Text="&#xE714;" FontFamily="Segoe MDL2 Assets" FontSize="36"
                                                   Foreground="{DynamicResource NoSignalBrush}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="NO SIGNAL" FontSize="18" FontWeight="SemiBold"
                                                   Foreground="{DynamicResource NoSignalBrush}" HorizontalAlignment="Center" Margin="0,6,0,0"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Border>
                    </Border>

                    <!-- Transition Controls (center) — vertical bar -->
                    <controls:TransitionBar Grid.Column="1" DataContext="{Binding Switcher}"
                                            VerticalAlignment="Center"/>

                    <!-- PROGRAM Monitor (right) — shows the live/transition output -->
                    <Border Grid.Column="2" CornerRadius="4"
                            BorderBrush="{Binding RecordingBorderBrush}"
                            BorderThickness="{Binding RecordingBorderThickness}"
                            Effect="{DynamicResource MonitorShadow}">
                        <Border CornerRadius="4" BorderBrush="{DynamicResource TallyRedBrush}" BorderThickness="3" ClipToBounds="True">
                            <Grid>
                                <controls:ProgramMonitorControl DataContext="{Binding Switcher}"/>

                                <!-- PROGRAM label badge (red) -->
                                <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                                        Background="{DynamicResource ProgramBadgeBrush}" Padding="10,4" Margin="8,6"
                                        CornerRadius="3" IsHitTestVisible="False">
                                    <TextBlock Text="PROGRAM" Foreground="White" FontSize="11"
                                               FontWeight="Bold"/>
                                </Border>

                                <!-- Timecode Overlay -->
                                <Border HorizontalAlignment="Left" VerticalAlignment="Bottom"
                                        Background="#80000000" Padding="10,4" Margin="8,0,0,8"
                                        CornerRadius="3" IsHitTestVisible="False">
                                    <controls:TimecodeDisplay Timecode="{Binding Timecode.CurrentTimecode}"/>
                                </Border>

                                <!-- Recording Indicator -->
                                <Border HorizontalAlignment="Right" VerticalAlignment="Top"
                                        Padding="8,4" Margin="8,6"
                                        CornerRadius="3" IsHitTestVisible="False"
                                        Visibility="{Binding IsRecording, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#E0FF0000"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPaused}" Value="True">
                                                    <Setter Property="Background" Value="#E0CCAA00"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <StackPanel Orientation="Horizontal">
                                        <Ellipse Width="10" Height="10" Fill="White" Margin="0,0,6,0">
                                            <Ellipse.Style>
                                                <Style TargetType="Ellipse">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPaused}" Value="True">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Ellipse.Style>
                                        </Ellipse>
                                        <TextBlock Foreground="White" FontWeight="Bold" FontSize="12">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Text" Value="REC"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsPaused}" Value="True">
                                                            <Setter Property="Text" Value="PAUSED"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                        <TextBlock Text="{Binding RecordingDuration, StringFormat=' {0:hh\\:mm\\:ss}'}"
                                                   Foreground="White" FontWeight="Bold" FontSize="12"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Border>
                    </Border>
                </Grid>

                <!-- Row 1: Input Source Strip (scrollable horizontal thumbnails) -->
                <Border Grid.Row="1" Background="{DynamicResource BackgroundLevel1Brush}"
                        CornerRadius="4" Margin="8,0,8,4" Padding="6,6">
                    <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled">
                      <StackPanel Orientation="Horizontal">
                        <ItemsControl ItemsSource="{Binding InputConfiguration.Inputs}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Margin="3,2" CornerRadius="4" Cursor="Hand"
                                            Background="{DynamicResource BackgroundLevel2Brush}"
                                            MouseLeftButtonDown="OnInputThumbnailClick"
                                            MouseRightButtonDown="OnInputThumbnailRightClick"
                                            MouseMove="OnInputThumbnailDragMove"
                                            AllowDrop="True"
                                            DragOver="OnInputThumbnailDragOver"
                                            Drop="OnInputThumbnailDrop"
                                            Tag="{Binding}"
                                            VerticalAlignment="Top">
                                        <Border.Effect>
                                            <DropShadowEffect BlurRadius="4" ShadowDepth="1" Opacity="0.3" Color="Black"/>
                                        </Border.Effect>
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="BorderThickness" Value="2"/>
                                                <Setter Property="BorderBrush" Value="Transparent"/>
                                                <Style.Triggers>
                                                    <!-- Dim disabled inputs -->
                                                    <DataTrigger Binding="{Binding IsEnabled}" Value="False">
                                                        <Setter Property="Opacity" Value="0.4"/>
                                                    </DataTrigger>
                                                    <!-- Green border when on preview -->
                                                    <DataTrigger Binding="{Binding IsPreviewSource}" Value="True">
                                                        <Setter Property="BorderBrush" Value="{DynamicResource TallyGreenBrush}"/>
                                                    </DataTrigger>
                                                    <!-- Red border when on program (higher priority) -->
                                                    <DataTrigger Binding="{Binding IsProgramSource}" Value="True">
                                                        <Setter Property="BorderBrush" Value="{DynamicResource TallyRedBrush}"/>
                                                    </DataTrigger>
                                                    <!-- Hover lift effect -->
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="BorderBrush" Value="{DynamicResource AccentBlueBrush}"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <StackPanel Width="180">
                                            <!-- Thumbnail preview with vignette -->
                                            <Grid>
                                                <Viewbox Stretch="Uniform">
                                                    <Border Width="1920" Height="1080" Background="{DynamicResource BackgroundLevel0Brush}">
                                                        <Image Source="{Binding PreviewImage}" Stretch="Fill"
                                                               RenderOptions.BitmapScalingMode="LowQuality"/>
                                                    </Border>
                                                </Viewbox>
                                                <!-- Camera number badge -->
                                                <Border HorizontalAlignment="Left" VerticalAlignment="Top"
                                                        Background="#80000000" Padding="5,2" Margin="2" CornerRadius="2" IsHitTestVisible="False">
                                                    <TextBlock Text="{Binding InputIndex, StringFormat='{}{0}'}"
                                                               Foreground="White" FontSize="9" FontWeight="Bold" FontFamily="Consolas"/>
                                                </Border>
                                                <!-- Bottom gradient vignette -->
                                                <Border VerticalAlignment="Bottom" Height="24" IsHitTestVisible="False">
                                                    <Border.Background>
                                                        <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                                            <GradientStop Color="Transparent" Offset="0"/>
                                                            <GradientStop Color="#60000000" Offset="1"/>
                                                        </LinearGradientBrush>
                                                    </Border.Background>
                                                </Border>
                                            </Grid>
                                            <!-- Source name + PVW/PGM badges -->
                                            <Grid Margin="6,3,6,4">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{Binding ShortName}"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           FontSize="10" FontWeight="SemiBold"
                                                           TextTrimming="CharacterEllipsis"/>
                                                <!-- PVW badge -->
                                                <Border Grid.Column="1" Padding="4,1" CornerRadius="2"
                                                        VerticalAlignment="Center" Margin="2,0">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsPreviewSource}" Value="True">
                                                                    <Setter Property="Background" Value="{DynamicResource PvwBadgeBrush}"/>
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock Text="PVW" Foreground="White" FontSize="8" FontWeight="Bold"/>
                                                </Border>
                                                <!-- PGM badge -->
                                                <Border Grid.Column="2" Padding="4,1" CornerRadius="2"
                                                        VerticalAlignment="Center">
                                                    <Border.Style>
                                                        <Style TargetType="Border">
                                                            <Setter Property="Visibility" Value="Collapsed"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsProgramSource}" Value="True">
                                                                    <Setter Property="Background" Value="{DynamicResource PgmBadgeBrush}"/>
                                                                    <Setter Property="Visibility" Value="Visible"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Border.Style>
                                                    <TextBlock Text="PGM" Foreground="White" FontSize="8" FontWeight="Bold"/>
                                                </Border>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <!-- Add virtual source button -->
                        <Button Click="OnAddVirtualSourceClick"
                                Style="{DynamicResource AddSourceButtonStyle}"
                                VerticalAlignment="Center" Margin="4,0"
                                ToolTip="Add virtual source">
                            <Button.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="Add Image..." Command="{Binding AddStillImageSourceCommand}"/>
                                    <MenuItem Header="Add Color..." Command="{Binding AddColorSourceCommand}"/>
                                </ContextMenu>
                            </Button.ContextMenu>
                        </Button>
                      </StackPanel>
                    </ScrollViewer>
                </Border>

                <!-- Row 2: Status Bar (Golf state, input status) -->
                <Border Grid.Row="2" Background="{DynamicResource BackgroundLevel1Brush}" Padding="8,4">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- Input Status -->
                        <TextBlock Grid.Column="0" Text="{Binding InputStatus}"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   VerticalAlignment="Center" FontSize="11"/>

                        <!-- Auto-Cut State (golf mode) -->
                        <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Border Padding="6,2" CornerRadius="3" Margin="4,0">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Background" Value="{DynamicResource BackgroundLevel2Brush}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding AutoCutStateText}" Value="Swing!">
                                                <Setter Property="Background" Value="#40FFAA00"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding AutoCutStateText}" Value="Following">
                                                <Setter Property="Background" Value="#4000AAFF"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <TextBlock Text="{Binding AutoCutStateText}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                           FontSize="11" FontWeight="SemiBold"/>
                            </Border>
                        </StackPanel>

                        <!-- Swing Counter (golf mode) -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center"
                                    Margin="8,0"
                                    Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                            <TextBlock Text="Swings: " Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="11" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding SwingCount}" FontSize="14" FontWeight="Bold"
                                       Foreground="{DynamicResource AccentBlueBrush}"
                                       VerticalAlignment="Center"/>
                            <TextBlock Text="  Practice: " Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="10" VerticalAlignment="Center"/>
                            <TextBlock Text="{Binding PracticeSwingCount}" FontSize="12" FontWeight="SemiBold"
                                       Foreground="{DynamicResource TextSecondaryBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>

                        <!-- Session Status (golf mode) -->
                        <StackPanel Grid.Column="3" Orientation="Horizontal" VerticalAlignment="Center"
                                    Margin="8,0"
                                    Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Ellipse Width="7" Height="7" Margin="0,0,4,0" VerticalAlignment="Center">
                                <Ellipse.Style>
                                    <Style TargetType="Ellipse">
                                        <Setter Property="Fill" Value="#666"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSessionActive}" Value="True">
                                                <Setter Property="Fill" Value="#44FF44"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Ellipse.Style>
                            </Ellipse>
                            <TextBlock Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"
                                       VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="No Session"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsSessionActive}" Value="True">
                                                <Setter Property="Text" Value="Session Active"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>

                        <!-- CUT buttons (golf mode quick access) -->
                        <StackPanel Grid.Column="4" Orientation="Horizontal" VerticalAlignment="Center"
                                    Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                            <Button Content="GOLFER" Command="{Binding CutToSource1Command}"
                                    Width="80" Height="24" Margin="2,0" Padding="4,2"
                                    FontSize="10" FontWeight="Bold">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ActiveSourceIndex}" Value="0">
                                                <Setter Property="BorderBrush" Value="{DynamicResource TallyRedBrush}"/>
                                                <Setter Property="Background" Value="#40FF0000"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                            <Button Content="SIMULATOR" Command="{Binding CutToSource2Command}"
                                    Width="80" Height="24" Margin="2,0" Padding="4,2"
                                    FontSize="10" FontWeight="Bold">
                                <Button.Style>
                                    <Style TargetType="Button" BasedOn="{StaticResource SecondaryButtonStyle}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ActiveSourceIndex}" Value="1">
                                                <Setter Property="BorderBrush" Value="{DynamicResource TallyRedBrush}"/>
                                                <Setter Property="Background" Value="#40FF0000"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Button.Style>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>

            <GridSplitter Grid.Column="3" Width="5" HorizontalAlignment="Center"
                          Background="{DynamicResource BorderSubtleBrush}"
                          Visibility="{Binding IsRightPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <!-- Right Panel: Recording Controls & Meters -->
            <ScrollViewer Grid.Column="4" VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled"
                          Background="{DynamicResource BackgroundLevel0Brush}"
                          Visibility="{Binding IsRightPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Quick Schedule -->
                <Border Grid.Row="0" Margin="4,4,4,2" Padding="0"
                        Background="{DynamicResource BackgroundLevel2Brush}"
                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                        BorderThickness="1" CornerRadius="6">
                    <StackPanel>
                        <Border Background="{DynamicResource PanelHeaderGradient}" CornerRadius="6,6,0,0" Padding="0">
                            <Border BorderBrush="{DynamicResource AccentYellowBrush}" BorderThickness="3,0,0,0"
                                    CornerRadius="6,0,0,0" Padding="10,8,10,8">
                                <TextBlock Style="{DynamicResource PanelHeaderStyle}" Margin="0">
                                    <Run Text="SCHEDULE"/>
                                    <Run Text=" &#x2014; " Foreground="{DynamicResource TextSecondaryBrush}"/>
                                    <Run Text="{Binding InputConfiguration.SelectedInput.ShortName, Mode=OneWay}"
                                         Foreground="{DynamicResource TextSecondaryBrush}"/>
                                </TextBlock>
                            </Border>
                        </Border>

                        <StackPanel Margin="10,8,10,10">
                            <!-- Start Time -->
                            <TextBlock Text="Start Time" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,0,4"/>
                            <TextBox Text="{Binding ScheduledStartTime, StringFormat='{}{0:HH:mm}', UpdateSourceTrigger=PropertyChanged}"
                                     Background="{DynamicResource BackgroundLevel0Brush}"
                                     Foreground="{DynamicResource TextPrimaryBrush}"
                                     BorderBrush="{DynamicResource BorderSubtleBrush}"
                                     Padding="8,6" ToolTip="Enter time as HH:mm (24-hour format)"/>

                            <!-- Duration -->
                            <TextBlock Text="Duration" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,8,0,4"/>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0"
                                         Text="{Binding ScheduledDurationHours, UpdateSourceTrigger=PropertyChanged}"
                                         Background="{DynamicResource BackgroundLevel0Brush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}"
                                         BorderBrush="{DynamicResource BorderSubtleBrush}"
                                         Padding="8,6" TextAlignment="Center"/>
                                <TextBlock Grid.Column="1" Text="h" Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="4,0,8,0"/>
                                <TextBox Grid.Column="2"
                                         Text="{Binding ScheduledDurationMinutes, UpdateSourceTrigger=PropertyChanged}"
                                         Background="{DynamicResource BackgroundLevel0Brush}"
                                         Foreground="{DynamicResource TextPrimaryBrush}"
                                         BorderBrush="{DynamicResource BorderSubtleBrush}"
                                         Padding="8,6" TextAlignment="Center"/>
                                <TextBlock Grid.Column="3" Text="m" Foreground="{DynamicResource TextSecondaryBrush}"
                                           VerticalAlignment="Center" Margin="4,0,0,0"/>
                            </Grid>

                            <!-- Schedule Buttons -->
                            <Grid Margin="0,12,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" Content="Schedule"
                                        Command="{Binding CreateQuickScheduleCommand}"
                                        Margin="0,0,4,0" Padding="8,6"
                                        Background="{DynamicResource AccentBlueBrush}"
                                        Foreground="White"/>
                                <Button Grid.Column="1" Content="Manage..."
                                        Command="{Binding OpenSchedulerCommand}"
                                        Margin="4,0,0,0" Padding="8,6"
                                        Background="{DynamicResource BackgroundLevel3Brush}"
                                        Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </Grid>

                            <!-- Schedule Status -->
                            <TextBlock Text="{Binding ScheduleStatusText}"
                                       Foreground="{DynamicResource AccentBlueBrush}"
                                       FontSize="11" Margin="0,8,0,0"
                                       TextWrapping="Wrap"
                                       Visibility="{Binding ScheduleStatusText, Converter={StaticResource NullToVisibilityConverter}}"/>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Golf Mode Controls -->
                <Border Grid.Row="1" Margin="4,2,4,2" Padding="0"
                        Background="{DynamicResource BackgroundLevel2Brush}"
                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                        BorderThickness="1" CornerRadius="6"
                        Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <Border Background="{DynamicResource PanelHeaderGradient}" CornerRadius="6,6,0,0" Padding="0">
                            <Border BorderBrush="#FF44BB44" BorderThickness="3,0,0,0"
                                    CornerRadius="6,0,0,0" Padding="10,8,10,8">
                                <TextBlock Text="GOLF MODE" Style="{DynamicResource PanelHeaderStyle}" Margin="0"/>
                            </Border>
                        </Border>

                        <StackPanel Margin="10,8,10,10">
                            <!-- Auto-Cut Toggle -->
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Auto-Cut" Foreground="{DynamicResource TextPrimaryBrush}"
                                           FontSize="12" VerticalAlignment="Center"/>
                                <ToggleButton Grid.Column="1" IsChecked="{Binding IsAutoCutEnabled}"
                                              Style="{DynamicResource OnOffToggleButtonStyle}"/>
                            </Grid>

                            <!-- Sensitivity -->
                            <TextBlock Text="Sensitivity" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,0,4"/>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" Content="High" FontSize="10" Padding="4,3" Margin="0,0,2,0"
                                        Command="{Binding SetSensitivityPresetCommand}" CommandParameter="High"
                                        Style="{DynamicResource SecondaryButtonStyle}"/>
                                <Button Grid.Column="1" Content="Normal" FontSize="10" Padding="4,3" Margin="2,0"
                                        Command="{Binding SetSensitivityPresetCommand}" CommandParameter="Normal"
                                        Style="{DynamicResource SecondaryButtonStyle}"/>
                                <Button Grid.Column="2" Content="Low" FontSize="10" Padding="4,3" Margin="2,0,0,0"
                                        Command="{Binding SetSensitivityPresetCommand}" CommandParameter="Low"
                                        Style="{DynamicResource SecondaryButtonStyle}"/>
                            </Grid>
                            <Slider Minimum="2" Maximum="8" Value="{Binding AutoCutSensitivity}"
                                    TickFrequency="0.5" IsSnapToTickEnabled="True"
                                    ToolTip="Lower = more sensitive"/>

                            <!-- Calibrate -->
                            <Button Content="Calibrate Idle Reference" Margin="0,8,0,0"
                                    Command="{Binding CalibrateIdleCommand}"
                                    Padding="8,6"
                                    Style="{DynamicResource SecondaryButtonStyle}"/>
                            <TextBlock FontSize="10" Margin="0,4,0,0"
                                       Foreground="{DynamicResource TextSecondaryBrush}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="Not calibrated"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsIdleCalibrated}" Value="True">
                                                <Setter Property="Text" Value="Calibrated"/>
                                                <Setter Property="Foreground" Value="#44FF44"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>

                            <!-- Golfer Selector -->
                            <TextBlock Text="Golfer" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="11" Margin="0,0,0,4"/>
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <ComboBox ItemsSource="{Binding AvailableGolfers}"
                                          SelectedItem="{Binding SelectedGolfer}"
                                          DisplayMemberPath="EffectiveDisplayName"/>
                                <Button Grid.Column="1" Content="Manage..."
                                        Command="{Binding OpenGolferManagementCommand}"
                                        Margin="6,0,0,0" Padding="8,4" FontSize="11"
                                        Style="{DynamicResource SecondaryButtonStyle}"/>
                            </Grid>

                            <!-- Overlay Settings -->
                            <Button Content="Overlay Settings..."
                                    Command="{Binding OpenOverlaySettingsCommand}"
                                    Padding="8,6" Margin="0,0,0,8"
                                    Style="{DynamicResource SecondaryButtonStyle}"
                                    HorizontalAlignment="Left"/>

                            <!-- Auto-Upload -->
                            <Grid Margin="0,0,0,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="Auto-Upload" Foreground="{DynamicResource TextPrimaryBrush}"
                                           FontSize="11" VerticalAlignment="Center"/>
                                <ToggleButton Grid.Column="1" IsChecked="{Binding AutoUploadEnabled}"
                                              Style="{DynamicResource OnOffToggleButtonStyle}"
                                              FontSize="10" Padding="8,3"/>
                            </Grid>
                            <ComboBox ItemsSource="{Binding AvailableUploadProviders}"
                                      SelectedValuePath="ProviderId"
                                      DisplayMemberPath="DisplayName"
                                      SelectedValue="{Binding SelectedUploadProviderId}"
                                      Margin="0,0,0,8" FontSize="11"
                                      Visibility="{Binding AutoUploadEnabled, Converter={StaticResource BoolToVisibilityConverter}}"/>

                            <!-- Session Controls -->
                            <Grid Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Button Grid.Column="0" Content="Start Session"
                                        Command="{Binding StartGolfSessionCommand}"
                                        Margin="0,0,4,0" Padding="8,6"
                                        Background="{DynamicResource AccentGreenBrush}"
                                        Foreground="White">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="IsEnabled" Value="True"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSessionActive}" Value="True">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                <Button Grid.Column="1" Content="End Session"
                                        Command="{Binding StopGolfSessionCommand}"
                                        Margin="4,0,0,0" Padding="8,6"
                                        Background="{DynamicResource AccentRedBrush}"
                                        Foreground="White"
                                        IsEnabled="{Binding IsSessionActive}"/>
                            </Grid>

                            <!-- Motion Diagnostic -->
                            <TextBlock Text="Motion Level" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="10" Margin="0,10,0,2"/>
                            <ProgressBar Height="6" Maximum="2000" Value="{Binding MotionLevel, Mode=OneWay}"
                                         Background="{DynamicResource BackgroundLevel0Brush}"
                                         Foreground="{DynamicResource AccentBlueBrush}"/>

                            <!-- Audio Level Diagnostic -->
                            <TextBlock Text="Audio Level" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="10" Margin="0,6,0,2"/>
                            <ProgressBar Height="6" Minimum="-60" Maximum="0" Value="{Binding AudioLevel, Mode=OneWay}"
                                         Background="{DynamicResource BackgroundLevel0Brush}"
                                         Foreground="#4CAF50"/>

                            <!-- Recent Cuts -->
                            <TextBlock Text="Recent Cuts" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="10" FontWeight="SemiBold" Margin="0,10,0,4"
                                       Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <ItemsControl ItemsSource="{Binding CutHistory}"
                                          Visibility="{Binding IsGolfModeEnabled, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource BackgroundLevel0Brush}"
                                                CornerRadius="2" Padding="4,2" Margin="0,1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding TimeDisplay}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           FontSize="10" FontFamily="Consolas" Margin="0,0,6,0"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Direction}"
                                                           FontSize="10" FontWeight="SemiBold" Margin="0,0,6,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="{DynamicResource AccentBlueBrush}"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Direction}" Value="-> GOLFER">
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentGreenBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                                <TextBlock Grid.Column="2" Text="{Binding Reason}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           FontSize="9" VerticalAlignment="Center"
                                                           TextTrimming="CharacterEllipsis"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Export Queue -->
                            <TextBlock Text="Export Queue" Foreground="{DynamicResource TextSecondaryBrush}"
                                       FontSize="10" FontWeight="SemiBold" Margin="0,10,0,4"
                                       Visibility="{Binding IsSessionActive, Converter={StaticResource BoolToVisibilityConverter}}"/>
                            <ItemsControl ItemsSource="{Binding ExportQueue}"
                                          Visibility="{Binding IsSessionActive, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{DynamicResource BackgroundLevel0Brush}"
                                                CornerRadius="3" Padding="6,3" Margin="0,1">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0"
                                                           Text="{Binding SwingNumber, StringFormat='Swing {0}'}"
                                                           Foreground="{DynamicResource TextPrimaryBrush}"
                                                           FontSize="11" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Duration, StringFormat='{}{0:m\\:ss}'}"
                                                           Foreground="{DynamicResource TextSecondaryBrush}"
                                                           FontSize="10" Margin="8,0" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{Binding Status}"
                                                           FontSize="10" VerticalAlignment="Center">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Foreground" Value="{DynamicResource TextSecondaryBrush}"/>
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Status}" Value="Complete">
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentGreenBrush}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Failed">
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentRedBrush}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Extracting">
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentBlueBrush}"/>
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding Status}" Value="Applying Overlays">
                                                                    <Setter Property="Foreground" Value="{DynamicResource AccentOrangeBrush}"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Timecode Display -->
                <Border Grid.Row="2" Margin="4,2,4,2" Padding="0"
                        Background="{DynamicResource BackgroundLevel2Brush}"
                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                        BorderThickness="1" CornerRadius="6">
                    <StackPanel>
                        <Border Background="{DynamicResource PanelHeaderGradient}" CornerRadius="6,6,0,0" Padding="0">
                            <Border BorderBrush="{DynamicResource AccentOrangeBrush}" BorderThickness="3,0,0,0"
                                    CornerRadius="6,0,0,0" Padding="10,8,10,8">
                                <TextBlock Text="TIMECODE" Style="{DynamicResource PanelHeaderStyle}" Margin="0"/>
                            </Border>
                        </Border>
                        <StackPanel Margin="10,8,10,10">
                            <controls:TimecodeDisplay Timecode="{Binding Timecode.CurrentTimecode}"
                                                      HorizontalAlignment="Center"
                                                      FontSize="36"/>
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,8,0,0">
                                <TextBlock Text="{Binding Timecode.Source}"
                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                <TextBlock Text=" | " Foreground="{DynamicResource TextSecondaryBrush}"/>
                                <TextBlock Text="{Binding Timecode.SelectedTimezone.DisplayName}"
                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Audio Meters -->
                <Border Grid.Row="3" Margin="4,2,4,2" Padding="0"
                        Background="{DynamicResource BackgroundLevel2Brush}"
                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                        BorderThickness="1" CornerRadius="6">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Border Background="{DynamicResource PanelHeaderGradient}" CornerRadius="6,6,0,0" Padding="0" Grid.Row="0">
                            <Border BorderBrush="{DynamicResource AccentRedBrush}" BorderThickness="3,0,0,0"
                                    CornerRadius="6,0,0,0" Padding="10,8,10,8">
                                <DockPanel>
                                    <TextBlock Text="AUDIO LEVELS" Style="{DynamicResource PanelHeaderStyle}" Margin="0"/>
                                    <ToggleButton DockPanel.Dock="Right" IsChecked="{Binding IsAudioLocked}"
                                                  Command="{Binding ToggleAudioLockCommand}"
                                                  Width="24" Height="24" Margin="4,0,0,0"
                                                  Background="Transparent" BorderThickness="0"
                                                  ToolTip="Lock audio to current source"
                                                  HorizontalAlignment="Right">
                                        <TextBlock Text="&#xE785;" FontFamily="Segoe MDL2 Assets" FontSize="14"
                                                   Foreground="{DynamicResource TextSecondaryBrush}" HorizontalAlignment="Center">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsAudioLocked}" Value="True">
                                                            <Setter Property="Foreground" Value="{DynamicResource AccentRedBrush}"/>
                                                            <Setter Property="Text" Value="&#xE72E;"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding IsAudioLocked}" Value="False">
                                                            <Setter Property="Text" Value="&#xE785;"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </ToggleButton>
                                </DockPanel>
                            </Border>
                        </Border>
                        <controls:AudioMetersPanel Grid.Row="1"
                                                   DataContext="{Binding AudioMeters}"
                                                   Margin="10,8,10,10"/>
                    </Grid>
                </Border>

                <!-- Drive Status -->
                <Border Grid.Row="4" Margin="4,2,4,4" Padding="0"
                        Background="{DynamicResource BackgroundLevel2Brush}"
                        BorderBrush="{DynamicResource BorderSubtleBrush}"
                        BorderThickness="1" CornerRadius="6">
                    <StackPanel>
                        <Border Background="{DynamicResource PanelHeaderGradient}" CornerRadius="6,6,0,0" Padding="0">
                            <Border BorderBrush="#FF9E9E9E" BorderThickness="3,0,0,0"
                                    CornerRadius="6,0,0,0" Padding="10,8,10,8">
                                <TextBlock Text="DRIVE STATUS" Style="{DynamicResource PanelHeaderStyle}" Margin="0"/>
                            </Border>
                        </Border>
                        <Grid Margin="10,8,10,10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <StackPanel>
                                <TextBlock Text="{Binding DriveStatus.DriveName}"
                                           Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock Text="{Binding DriveStatus.FreeSpaceDisplay}"
                                           Foreground="{DynamicResource TextSecondaryBrush}"/>
                                <TextBlock Text="{Binding DriveStatus.RecordingTimeRemaining}"
                                           Foreground="{DynamicResource TextSecondaryBrush}" FontSize="11"/>
                            </StackPanel>
                            <controls:DriveSpaceIndicator Grid.Column="1"
                                                          UsedPercent="{Binding DriveStatus.UsedPercent}"
                                                          Width="48" Height="48"/>
                        </Grid>
                    </StackPanel>
                </Border>
            </Grid>
            </ScrollViewer>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{DynamicResource StatusBarGradient}"
                BorderBrush="{DynamicResource BorderSubtleBrush}" BorderThickness="0,1,0,0"
                Padding="8,5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" Text="{Binding InputStatusText}"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>

                <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="16,0" HorizontalAlignment="Center">
                    <TextBlock Text="{Binding InputConfiguration.SelectedInput.FormatDescription}"
                               Foreground="{DynamicResource AccentBlueBrush}" FontWeight="SemiBold"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal" Margin="16,0">
                    <TextBlock Text="Dropped: " Foreground="{DynamicResource TextSecondaryBrush}"/>
                    <TextBlock Text="{Binding DroppedFrames}"
                               Foreground="{Binding DroppedFramesColor}"/>
                    <Button x:Name="ViewersButton" Command="{Binding ShowViewersCommand}"
                            Margin="16,0,0,0" Padding="6,2" Cursor="Hand"
                            Background="Transparent" BorderThickness="0"
                            Visibility="{Binding IsStreaming, Converter={StaticResource BoolToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="6" Height="6" Fill="{DynamicResource AccentRedBrush}"
                                     VerticalAlignment="Center" Margin="0,0,4,0"/>
                            <TextBlock Text="Viewers: " Foreground="{DynamicResource TextSecondaryBrush}" FontSize="12"/>
                            <TextBlock Text="{Binding ConnectedViewers}" Foreground="{DynamicResource AccentBlueBrush}" FontSize="12"/>
                        </StackPanel>
                    </Button>
                </StackPanel>

                <TextBlock Grid.Column="3" Text="{Binding DriveStatus.FreeSpaceDisplay}"
                           Foreground="{DynamicResource TextSecondaryBrush}" Margin="16,0"/>

                <TextBlock Grid.Column="4" Text="{Binding CurrentTime, StringFormat='{}{0:HH:mm:ss}'}"
                           Foreground="{DynamicResource TextSecondaryBrush}"/>
            </Grid>
        </Border>
    </Grid>
</Window>
